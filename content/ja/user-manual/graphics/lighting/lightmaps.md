---
title: ライトマップ
template: usermanual-page.tmpl.html
position: 3
---

![Sponza][10]
*このシーン内のすべての照明はライトマップテクスチャによって提供されています*

ライトマップ生成は静的シーンの照明情報を事前に計算し、多くの場合素材に適用されるテクスチャに格納する処理です。これは、ライトソースや形状の多くが静的または環境に使用されている場合にシーンを照らす効率的な方法です。

PlayCanvasでは、シーン内のライトマップを使用するための方法が2つあります。

## 外部ライトマップの生成

多くの3Dコンテンツツールには、ライトマップテクスチャを生成するための方法があります。たとえば、3DS、 Max、Maya、Blenderにはすべて、テクスチャにライトマップをベイクする方法があります。ライトマップ生成にオフラインツールを使用する利点は、グローバルイルミネーション、バウンスライティング、ソフトシャドウ、などの洗練された照明の計算ができるということです。主要な欠点は、3Dツール内でシーンを完全に描写する必要があるということです。PlayCanvasシーンがエディタ内に沢山のインスタンスを配置している場合、ライトマップツールの中にこれを再作成する必要があります。

外部ツールを使用してライトマップを作成したら、通常のテクスチャアセットとしてアップロードすれば標準のPhysical Materialのライトマップスロットを使用して素材に添加することができます。

![ライトマップスロット][1]

## PlayCanvas 実行時のライトマップ生成

PlayCanvasではライトマップを生成する非常に便利な方法があります。Editorの標準的なライトコンポーネントを使用して、ライトマップをベークするために使用するライトと実行しにシーンを動的に照らすライトコンポーネントを選択します。ベークするために設定されたライトは、アプリケーション起動時にシーンを照らすライトマップを生成するために使用されます。

The advantages are so:

*照明は実行時に実行されません
*数百の静的ライトを使用してシーンを点灯することができます
*多くの場合、複数のライトマップテクスチャをダウンロードするよりも実行時にライトマップをレンダリングする方が速いです
*Editorで静的および動的ライトを混合することができます
*再ベークは、実行時に行うことができます
*ライトマップはHDRです

実行時のライトマップ生成を使用する欠点は、グローバルイルミネーション、アンビエントオクルージョンやその他の特殊なベーキングツールの高度な機能のをベーキングに現在対応していないということです。

### ベーキング用にライトを設定

各ライトコンポーネントには、ライトマップベーキングを有効にするための設定が含まれています。デフォルトで、新しいライトは動的に設定されています。

![動的なライト][2]

**Lightmap: Bake**設定を有効にすると、照明は範囲内にある全てのライトマップされたモデルのライトマップをベークします。

ライトの動作を変更する方法が他に二つあります。これらは、光が実行時に影響を与えるモデルを決定します。これらのいずれかをtrueにすると、照明は実行時に動作し、実行時の負荷に影響します。

**Affect Dynamic** ボックスがtrueの場合、この照明はライトマップ**されていない**全てのモデルに影響を与えます。**Affect Lightmapped**ボックスがtrueの場合、この照明はライトマップ**されている**全てのモデルに影響を与えます。

照明の**Lightmap**と**Affect Lightmapped**を両方trueにすることはできません。なぜなら、モデルにライトマップが生成されているのに、実行時にもライトが同じライティングを追加することになるからです。

![影][3]

ライトマップライトの影の設定は、動的ライトと同じですが、この場合はライトマップ生成時に一度影の計算が行われるのでライトマップライトに影を有効にする方が軽くなります。[影][4]の項を参照してください。

### ベーキング用にモデルを設定

各モデルコンポーネントでライトマップを受信するには、ライトマップを有効にする必要があります。ライトマップは、モデルコンポーネントのプロパティで**Lightmapped**オプションにチェックを入れて有効にします。

![モデルコンポーネント][5]

 **Shadows: Cast Lightmap** オプションはモデルがライトマップに影を落としているか否かを決定します。また、生成されたライトマップテクスチャの解像度を確認したり、その大きさに乗数を適用するためのオプションがあります。ライトマップのサイズ乗算については、以下で説明します。

### 一般的なライトの設定

ご覧の通り、いくつかの組み合わせのライトの設定があります。これらの組み合わせにはユースケースがあり、異なる組み合わせでライトを使用することにより、パフォーマンスと高品質なビジュアルのバランスをとることができます。

<table>
<tr>
    <th>ライトマップ</th><th>動的に影響</th><th>ライトマップに影響</th><th style="width: 50%;">説明</th>
</tr>
<tr>
    <td class="centered">false</td><td class="centered">true</td><td class="centered">false</td><td>これがデフォルトの動的ライトです。ライトマップされていない全てのモデルに影響します。</td>
</tr>
<tr>
    <td class="centered">true</td><td class="centered">false</td><td class="centered">false</td><td>このライトはライトマップされたモデルのライトマップを生成し、実行時に軽い負荷で使用できます。ほとんどの環境ライトは、この設定を使用します。</td>
</tr>
<tr>
    <td class="centered">true</td><td class="centered">true</td><td class="centered">false</td><td>このライトはライトマップを生成しますが、ライトマップされていないモデルにも影響を与えます。このライトで点灯する必要のある動的/移動するエンティティがある場合に便利です。例えば、プレイヤキャラクタにも影響を与える環境照明。</td>
</tr>
<tr>
    <td class="centered">false</td><td class="centered">true</td><td class="centered">true</td><td>このライトは、ライトマップされたモデルセルとライトマップされていないモデルの両方に影響を与える動的ライトです。例えば、懐中電灯などはこの設定を使用します。</td>
</tr>
</table>

### ライトマップのサイズ乗数

PlayCanvasは自動的にモデルに必要とされるライトマップの解像度を決定します。この値は、モデルのサイズおよび形状に基づいて計算されます。モデルコンポーネントのサイズ乗数フィールドを修正することで、この計算に影響を与えることができます。

![グローバル設定][6]

すべてのモデルコンポーネントに影響を与える、グローバルライトマップのサイズ乗数もあります。また、生成されたライトマップの最大解像度の上限を設定してメモリを節約することができます。

### 自動アンラップとUV1の生成

ライトマップは、常にモデルアセットのUV座標(UV1)の第2のセットを使用して適用されます。最良の結果を得るためには、モデルをPlayCanvasにアップロードする前に、3Dコンテンツツールに第2のUVセットを追加することをお勧めします。

便宜上、使用しているモデルがにUV1セットがない場合、PlayCanvas Editorは自動的にアンラップをしてモデルのためにUV1座標を生成することができます。

![UV1 の欠損][7]

モデルのUV1マップが不足している場合は、ライトマッピングを有効にするときに、モデルコンポーネントに警告が表示されます。

![自動アンラップ][8]

警告を解決するには、モデルアセットを選択して**Pipeline**セクションを開きます。**Auto-Unwrap**ボタンをクリックして、進行バーが完了するのを待ちます。自動アンラップを実行するとモデルアセットが編集され、ソースからモデルを再インポートすると(例えば、新しいFBXをアップロード)UV1が削除されてモデルの再アンラップが必要になります。

**padding**セクションでは、アンラップが発生した際のセクション間のスペースを決定します。ライトマップ上の不適切な場所にライトが表示されてしまう*"light bleeding"*が発生している場合、paddingを増やして軽減することができます。

[1]: /images/user-manual/material-inspector/lightmap.jpg
[2]: /images/user-manual/lighting/lightmaps/spot-dynamic.jpg
[3]: /images/user-manual/lighting/lightmaps/shadows.jpg
[4]: /user-manual/graphics/lighting/shadows
[5]: /images/user-manual/lighting/lightmaps/model-settings.jpg
[6]: /images/user-manual/lighting/lightmaps/global-lightmap-settings.jpg
[7]: /images/user-manual/lighting/lightmaps/uv1-missing.jpg
[8]: /images/user-manual/lighting/lightmaps/auto-unwrap.jpg
[10]: /images/user-manual/lighting/lightmaps/sponza.jpg

