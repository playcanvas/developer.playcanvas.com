"use strict";(self.webpackChunkdeveloper_playcanvas_com=self.webpackChunkdeveloper_playcanvas_com||[]).push([[1274],{86326:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var i=n(85893),a=n(11151);const o={title:"Making a Simple Game - Part 4",tags:["games"],thumb:"https://s3-eu-west-1.amazonaws.com/images.playcanvas.com/projects/12/406050/LIJTDO-image-75.jpg"},s=void 0,l={id:"tutorials/keepyup-part-four",title:"Making a Simple Game - Part 4",description:"You can find the full project here. If you haven't see Part 1, Part 2 and Part 3 read them first.",source:"@site/docs/tutorials/keepyup-part-four.md",sourceDirName:"tutorials",slug:"/tutorials/keepyup-part-four",permalink:"/tutorials/keepyup-part-four",draft:!1,unlisted:!1,editUrl:"https://github.com/playcanvas/developer.playcanvas.com/tree/dev/docs/tutorials/keepyup-part-four.md",tags:[{label:"games",permalink:"/tags/games"}],version:"current",frontMatter:{title:"Making a Simple Game - Part 4",tags:["games"],thumb:"https://s3-eu-west-1.amazonaws.com/images.playcanvas.com/projects/12/406050/LIJTDO-image-75.jpg"},sidebar:"tutorialsSidebar",previous:{title:"Making a Simple Game - Part 5",permalink:"/tutorials/keepyup-part-five"},next:{title:"Making a Simple Game - Part 1",permalink:"/tutorials/keepyup-part-one"}},r={},p=[{value:"The Football",id:"the-football",level:2},{value:"ball.js",id:"balljs",level:2},{value:"Script Attributes",id:"script-attributes",level:3},{value:"The Physics Simulation",id:"the-physics-simulation",level:3},{value:"Simulating",id:"simulating",level:4},{value:"Responding to input",id:"responding-to-input",level:4},{value:"Summary",id:"summary",level:2}];function c(e){const t={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"iframe-container",children:(0,i.jsx)("iframe",{loading:"lazy",src:"https://playcanv.as/p/KH37bnOk/?overlay=false",title:"Making a Simple Game - Part 4"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsxs)(t.em,{children:["You can find the ",(0,i.jsx)(t.a,{href:"https://playcanvas.com/project/406050",children:"full project here"}),". If you haven't see ",(0,i.jsx)(t.a,{href:"/tutorials/keepyup-part-one/",children:"Part 1"}),", ",(0,i.jsx)(t.a,{href:"/tutorials/keepyup-part-two/",children:"Part 2"})," and ",(0,i.jsx)(t.a,{href:"/tutorials/keepyup-part-three/",children:"Part 3"})," read them first."]})}),"\n",(0,i.jsx)(t.h2,{id:"the-football",children:"The Football"}),"\n",(0,i.jsx)(t.p,{children:"The football is the center of attention in our Keepy Up game. It responds to player input, it responds to the environment (well, gravity), it makes sounds. It's probably the most complicated part of the game. Fortunately, we're going to explain all the bits to your as simply as we can."}),"\n",(0,i.jsx)(t.h2,{id:"balljs",children:"ball.js"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"var Ball = pc.createScript('ball');\n\nBall.attributes.add('gravity', {\n    type: 'number',\n    default: -9.8,\n    description: 'The value of gravity to use'\n});\n\nBall.attributes.add('defaultTap', {\n    type: 'number',\n    default: 5,\n    description: 'Speed to set the ball to when it is tapped'\n});\n\nBall.attributes.add('impactEffect', {\n    type: 'entity',\n    description: 'The particle effect to trigger when the ball is tapped'\n});\n\nBall.attributes.add('ballMinimum', {\n    type: 'number',\n    default: -6,\n    description: 'When ball goes below minimum y value game over is triggered'\n});\n\nBall.attributes.add('speedMult', {\n    type: 'number',\n    default: 4,\n    description: 'Multiplier to apply to X speed when tap is off center'\n});\n\nBall.attributes.add('angMult', {\n    type: 'number',\n    default: -6,\n    description: 'Multiplier to apply to angular speed when tap is off center'\n});\n\nBall.tmp = new pc.Vec3();\n\n// initialize code called once per entity\nBall.prototype.initialize = function() {\n    this.paused = true;\n\n    // Get the \"Game\" Entity and start listening for events\n    this.game = this.app.root.findByName(\"Game\");\n\n    this.app.on(\"game:start\", this.unpause, this);\n    this.app.on(\"game:gameover\", this.pause, this);\n    this.app.on(\"game:reset\", this.reset, this);\n\n    // Initialize properties\n    this._vel = new pc.Vec3(0, 0, 0);\n    this._acc = new pc.Vec3(0, this.gravity, 0);\n    this._angSpeed = 0;\n\n    // Store the initial position and rotation for reseting\n    this._origin = this.entity.getLocalPosition().clone();\n    this._rotation = this.entity.getLocalRotation().clone();\n};\n\n// update code called every frame\nBall.prototype.update = function(dt) {\n    // Don't update when paused\n    if (this.paused) {\n        this.entity.rotate(0, 30*dt, 0);\n        return;\n    }\n\n    var p = this.entity.getLocalPosition();\n    var tmp = Ball.tmp;\n\n    // integrate the velocity in a temporary variable\n    tmp.copy(this._acc).scale(dt);\n    this._vel.add(tmp);\n\n    // integrate the position in a temporary variable\n    tmp.copy(this._vel).scale(dt);\n    p.add(tmp);\n\n    // update position\n    this.entity.setLocalPosition(p);\n\n    // rotate by angular speed\n    this.entity.rotate(0, 0, this._angSpeed);\n\n    // check for game over condition\n    if (p.y < this.ballMinimum) {\n        this.game.script.game.gameOver();\n    }\n};\n\n/*\n * Called by the input handler to tap the ball up in the air\n * dx is the tap distance from centre of ball in x\n * dy is the tap distance from centre of ball in y\n */\nBall.prototype.tap = function (dx, dy) {\n    // Update velocity and spin based on position of tap\n    this._vel.set(this.speedMult * dx, this.defaultTap, 0);\n    this._angSpeed += this.angMult * dx;\n\n    // calculate the position of the tap in world space\n    var tmp = Ball.tmp;\n    tmp.copy(this.entity.getLocalPosition());\n    tmp.x -= dx;\n    tmp.y -= dy;\n\n    // trigger particle effect to tap position, facing away from the center of the ball\n    this.impactEffect.setLocalPosition(tmp);\n    this.impactEffect.particlesystem.reset();\n    this.impactEffect.particlesystem.play();\n    this.impactEffect.lookAt(this.entity.getPosition());\n\n    // play audio\n    this.entity.sound.play(\"bounce\");\n\n    // increment the score by 1\n    this.game.script.game.addScore(1);\n};\n\n// Pause the ball update when not playing the game\nBall.prototype.unpause = function () {\n    this.paused = false;\n\n    // start game with a tap\n    this.tap(0, 0);\n};\n\n// Resume ball updating\nBall.prototype.pause = function () {\n    this.paused = true;\n};\n\n// Reset the ball to initial values\nBall.prototype.reset = function () {\n    this.entity.setLocalPosition(this._origin);\n    this.entity.setLocalRotation(this._rotation);\n    this._vel.set(0,0,0);\n    this._acc.set(0, this.gravity, 0);\n    this._angSpeed = 0;\n};\n"})}),"\n",(0,i.jsx)(t.h3,{id:"script-attributes",children:"Script Attributes"}),"\n",(0,i.jsx)(t.p,{children:"The first thing you'll notice at the top of the script are a set of script attributes that we've defined. Defining script attributes lets you expose values from your script into the editor. There are three very good reasons to do this."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"/images/tutorials/beginner/keepyup-part-four/ball-script-attributes.jpg",alt:"Script Attributes"})}),"\n",(0,i.jsx)(t.p,{children:"First, it lets you use the same script for many different Entities with different values. For example, you could have a script attribute which sets a color, and in the editor create a red, blue and green version of a entity just by modifying the script attribute."}),"\n",(0,i.jsxs)(t.p,{children:["Second, you can quickly and easily tune the behavior of scripts. When you modify a script attribute (or indeed any property from the editor) the changes are made instantly to any instance of the game that you have launched from the editor. So for example in the case of the ",(0,i.jsx)(t.code,{children:"ballMinimum"})," property we define here, you can launch the game and test what the value of ",(0,i.jsx)(t.code,{children:"ballMinimum"})," should be to allow the ball to drop off the bottom of the screen without ever having to reload the game. Test the game, modify the value, test the game."]}),"\n",(0,i.jsx)(t.p,{children:'This is known as "iteration speed". The faster you can modify and test your game, the quicker you can get it developed!'}),"\n",(0,i.jsx)(t.p,{children:"For the ball, we define script attributes that let us tweak a number of game play properties like the gravity, the impulse applied when the ball is tapped. These attributes let us very quickly tune the game to our liking."}),"\n",(0,i.jsxs)(t.p,{children:["Third, the script attribute is a great way to link a script to an Entity or an Asset in your scene. For example, the ball script needs to trigger a particle effect when it is tapped. The particle effect is on another Entity in our scene. We define a script attribute called ",(0,i.jsx)(t.code,{children:"impactEffect"})," of type ",(0,i.jsx)(t.code,{children:"entity"})," and in the Editor we link this to the entity with our particle effect. Our script now has a reference to the entity and we are free to modify this entity or change to another entity without breaking our code."]}),"\n",(0,i.jsx)(t.h3,{id:"the-physics-simulation",children:"The Physics Simulation"}),"\n",(0,i.jsxs)(t.p,{children:["For those of you with some basic vector maths knowledge this ",(0,i.jsx)(t.code,{children:"update()"})," loop of the ball should be simple, but for everyone else we'll explain a little about simulating a ball in a video game."]}),"\n",(0,i.jsx)(t.p,{children:"A simple way to simulate something in video game is to give that object an acceleration, a velocity and a position. Every time step (or frame) the acceleration (which the rate of change velocity) changes the velocity and the velocity (which is the rate of change of position) changes the position. Then you draw your object at the new position."}),"\n",(0,i.jsx)(t.p,{children:"You can influence the position of your object in one of three ways."}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Change the acceleration"}),", this is useful for applying a force over a period of time, like gravity on the ball."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Change the velocity"}),", this is an instantaneous change. Like a ball bouncing off the floor."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Change the position"}),", like teleportation, there isn't a real world equivalent!"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"In our simulation we have a constant acceleration due to gravity, when you tap the ball we apply an instant change in velocity and when you reset the game we teleport the ball back to it's starting position."}),"\n",(0,i.jsx)(t.h4,{id:"simulating",children:"Simulating"}),"\n",(0,i.jsx)(t.p,{children:"The update loop does this:"}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.em,{children:"(Change in Velocity) = (Acceleration) * (Time since last frame)"})}),"\n"]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.em,{children:"(New Velocity) = (Old Velocity) + (Change in Velocity)"})}),"\n"]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.em,{children:"(Change in Position) = (New Velocity) * (Time since last frame)"})}),"\n"]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.em,{children:"(New Position) = (Old Position) + (Change in Position)"})}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"In code this looks like this:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"var p = this.entity.getLocalPosition();\n\n// integrate the velocity in a temporary variable\ntmp.copy(this._acc).scale(dt);\nthis._vel.add(tmp);\n\n// integrate the position in a temporary variable\ntmp.copy(this._vel).scale(dt);\np.add(tmp);\n\n// update position\nthis.entity.setLocalPosition(p);\n"})}),"\n",(0,i.jsxs)(t.p,{children:["You will note that we use temporary vector ",(0,i.jsx)(t.code,{children:"tmp"})," to store intermediate values. It's important not to create a new vector every frame for this. Also notice that we have to call ",(0,i.jsx)(t.code,{children:"setLocalPosition"})," to apply the updated position."]}),"\n",(0,i.jsxs)(t.p,{children:["Finally, for a nice effect we add rotate the ball by the angular speed value using ",(0,i.jsx)(t.code,{children:"entity.rotate()"}),". This isn't very physically accurate, but it looks nice."]}),"\n",(0,i.jsx)(t.h4,{id:"responding-to-input",children:"Responding to input"}),"\n",(0,i.jsxs)(t.p,{children:["You may remember from ",(0,i.jsx)(t.a,{href:"/tutorials/keepyup-part-two/",children:"Part 2"})," that the ",(0,i.jsx)(t.code,{children:"input.js"})," script checked to see if an input has hit the ball and if so it calls the ",(0,i.jsx)(t.code,{children:"tap()"})," method. The ",(0,i.jsx)(t.code,{children:"tap()"})," method defined above applies a direct change to the velocity and the angular speed of the ball. We use a couple of our script attributes ",(0,i.jsx)(t.code,{children:"this.speedMult"})," and ",(0,i.jsx)(t.code,{children:"this.angMult"})," to multiple the new velocity and angular speed to match our expectations of the gameplay."]}),"\n",(0,i.jsxs)(t.p,{children:["We also use the tap method to trigger a particle dust cloud at the point of impact and play a sound effect. We'll talk about particle and sounds in ",(0,i.jsx)(t.a,{href:"/tutorials/keepyup-part-five/",children:"Part 5"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(t.p,{children:"The ball script runs a simply physical simulation to make the ball fall under gravity and respond to taps. It also listens for game events to know when to pause and reset. Finally, it interacts with some other systems to show particle effects and play sounds."})]})}function h(e={}){const{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},11151:(e,t,n)=>{n.d(t,{Z:()=>l,a:()=>s});var i=n(67294);const a={},o=i.createContext(a);function s(e){const t=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(o.Provider,{value:t},e.children)}}}]);